<div class="client-dashboard">
  <div class="welcome-section">
    <h1>
      <span nz-icon nzType="user" style="margin-right: 12px; color: #1890ff;"></span>
      Client Dashboard
    </h1>
    <p>Welcome, <strong>{{ currentUser?.name || currentUser?.email }}</strong>!</p>
    <p *ngIf="clientInfo">Client: <strong>{{ clientInfo.name }}</strong></p>
    <p>View client information, invoices, and manage orders.</p>
  </div>

  <div nz-row [nzGutter]="[16, 16]" class="stats-section">
    <div nz-col nzXs="24" nzSm="12" nzMd="6">
      <nz-card>
        <nz-statistic
          nzTitle="All Invoices"
          [nzValue]="stats.totalInvoices"
          [nzLoading]="loading">
          <ng-template #nzPrefix>
            <span nz-icon nzType="file-text" style="color: #52c41a;"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>
    </div>
    
    <div nz-col nzXs="24" nzSm="12" nzMd="6">
      <nz-card>
        <nz-statistic
          nzTitle="Outstanding Orders"
          [nzValue]="stats.pendingOrders"
          [nzLoading]="loading">
          <ng-template #nzPrefix>
            <span nz-icon nzType="clock-circle" style="color: #faad14;"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>
    </div>
    
    <div nz-col nzXs="24" nzSm="12" nzMd="6">
      <nz-card>
        <nz-statistic
          nzTitle="Amount Due"
          [nzValue]="stats.unpaidAmount"
          nzSuffix="€"
          [nzLoading]="loading">
          <ng-template #nzPrefix>
            <span nz-icon nzType="exclamation-circle" style="color: #f5222d;"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>
    </div>
    
    <div nz-col nzXs="24" nzSm="12" nzMd="6">
      <nz-card>
        <nz-statistic
          nzTitle="Total Paid"
          [nzValue]="stats.totalSpent"
          nzSuffix="€"
          [nzLoading]="loading">
          <ng-template #nzPrefix>
            <span nz-icon nzType="dollar-circle" style="color: #13c2c2;"></span>
          </ng-template>
        </nz-statistic>
      </nz-card>
    </div>
  </div>

  <div nz-row [nzGutter]="[16, 16]" class="client-actions">
    <div nz-col nzXs="24" nzSm="12" nzMd="8">
      <nz-card nzTitle="Quick Actions" nzSize="small">
        <ng-template #nzTitle>
          <span nz-icon nzType="thunderbolt" style="margin-right: 8px;"></span>
          Quick Actions
        </ng-template>
        <div class="action-buttons">
          <button nz-button nzType="primary" nzSize="large" routerLink="/shop">
            <span nz-icon nzType="shopping-cart"></span>
            Create Order
          </button>
          <button nz-button nzSize="large" routerLink="/shop/orders">
            <span nz-icon nzType="file-text"></span>
            View Orders
          </button>
          <button nz-button nzSize="large" routerLink="/shop/cart">
            <span nz-icon nzType="shopping-cart"></span>
            Cart
            <nz-badge [nzCount]="cartItemCount" [nzOffset]="[10, -5]" *ngIf="cartItemCount > 0"></nz-badge>
          </button>
        </div>
      </nz-card>
    </div>
    
    <div nz-col nzXs="24" nzSm="12" nzMd="8">
      <nz-card nzTitle="Recent Invoices" nzSize="small">
        <ng-template #nzTitle>
          <span nz-icon nzType="file-text" style="margin-right: 8px;"></span>
          Recent Invoices
        </ng-template>
        <div class="recent-invoices" *ngIf="!loading">
          <div class="invoice-item" *ngFor="let invoice of recentInvoices">
            <div class="invoice-header">
              <span class="invoice-number">{{ invoice.invoiceNumber }}</span>
              <nz-tag [nzColor]="getStatusColor(invoice.status)">
                {{ invoice.status }}
              </nz-tag>
            </div>
            <div class="invoice-details">
              <span class="invoice-amount">€{{ invoice.grandTotal | number:'1.2-2' }}</span>
              <span class="invoice-date">{{ invoice.createdAt | date:'short' }}</span>
            </div>
          </div>
          <div *ngIf="recentInvoices.length === 0" class="no-invoices">
            <p>No recent invoices found.</p>
          </div>
        </div>
        <div *ngIf="loading" class="loading-placeholder">
          <p>Loading recent invoices...</p>
        </div>
      </nz-card>
    </div>
    
    <div nz-col nzXs="24" nzSm="12" nzMd="8">
      <nz-card nzTitle="Account Info" nzSize="small">
        <div class="account-info" *ngIf="clientInfo">
          <p><strong>Account Status:</strong> 
            <nz-tag [nzColor]="clientInfo.status === 'ACTIVE' ? 'green' : 'red'">
              {{ clientInfo.status }}
            </nz-tag>
          </p>
          <p><strong>Credit Limit:</strong> €{{ clientInfo.creditLimit | number:'1.2-2' }}</p>
          <p><strong>Payment Terms:</strong> {{ clientInfo.paymentTerms }}</p>
          <p><strong>Currency:</strong> {{ clientInfo.preferredCurrency }}</p>
          <p *ngIf="clientSummary?.lastInvoiceAt"><strong>Last Invoice:</strong> 
            {{ clientSummary?.lastInvoiceAt | date:'short' }}
          </p>
        </div>
        <div *ngIf="!clientInfo && !loading" class="no-info">
          <p>Account information not available.</p>
        </div>
        <div *ngIf="loading" class="loading-placeholder">
          <p>Loading account info...</p>
        </div>
      </nz-card>
    </div>
  </div>
</div>
