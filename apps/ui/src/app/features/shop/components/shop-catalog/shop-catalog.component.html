<div class="shop-catalog">
  <!-- Header with cart badge -->
  <div class="catalog-header">
    <h1>Shop Products</h1>
    <div class="cart-info">
      <nz-badge [nzCount]="cartItemCount" [nzShowZero]="false">
        <button nz-button nzType="primary" routerLink="/shop/cart">
          <span nz-icon nzType="shopping-cart"></span>
          Cart
        </button>
      </nz-badge>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div nz-row [nzGutter]="[16, 16]">
      <div nz-col nzXs="24" nzSm="12" nzMd="8">
        <nz-input-group nzPrefixIcon="search">
          <input 
            nz-input 
            placeholder="Search products..." 
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
          />
        </nz-input-group>
      </div>
      <div nz-col nzXs="24" nzSm="12" nzMd="8">
        <nz-select 
          nzPlaceHolder="Filter by brand" 
          [(ngModel)]="selectedBrand"
          (ngModelChange)="onFilterChange()"
          nzAllowClear
        >
          <nz-option *ngFor="let brand of brands" [nzValue]="brand" [nzLabel]="brand"></nz-option>
        </nz-select>
      </div>
      <div nz-col nzXs="24" nzSm="12" nzMd="8">
        <nz-select 
          nzPlaceHolder="Filter by category" 
          [(ngModel)]="selectedGroup"
          (ngModelChange)="onFilterChange()"
          nzAllowClear
        >
          <nz-option *ngFor="let group of groups" [nzValue]="group.id" [nzLabel]="group.name"></nz-option>
        </nz-select>
      </div>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="products-section">
    <nz-spin [nzSpinning]="loading">
      <div nz-row [nzGutter]="[16, 16]" *ngIf="products.length > 0">
        <div nz-col nzXs="24" nzSm="12" nzMd="8" nzLg="6" *ngFor="let product of products">
          <nz-card 
            [nzHoverable]="true" 
            class="product-card"
            [nzBodyStyle]="{ padding: '16px' }"
          >
            <div class="product-image">
              <img 
                [src]="getProductImage(product)" 
                [alt]="product.name"
                class="product-img"
              />
            </div>
            
            <div class="product-info">
              <h3 class="product-name">{{ product.name }}</h3>
              <p class="product-sku">SKU: {{ product.sku }}</p>
              
              <div class="product-details">
                <div class="product-brand" *ngIf="product.brand">
                  <nz-tag nzColor="blue">{{ product.brand }}</nz-tag>
                </div>
                
                <div class="product-supplier">
                  <span class="supplier-label">Supplier:</span>
                  <span class="supplier-name">{{ product.supplier?.name }}</span>
                </div>
                
                <div class="product-unit" *ngIf="product.unit">
                  <span class="unit-label">Unit:</span>
                  <span class="unit-name">{{ product.unit.name }} ({{ product.unit.code }})</span>
                </div>
              </div>

              <!-- Product Attributes -->
              <div class="product-attributes" *ngIf="hasAttributes(product)">
                <div class="attribute-item" *ngFor="let attr of product.attributes | keyvalue">
                  <span class="attr-name">{{ attr.key }}:</span>
                  <span class="attr-value">{{ attr.value }}</span>
                </div>
              </div>
            </div>

            <div class="product-footer">
              <div class="product-price">
                <span class="price-label">Price:</span>
                <span class="price-value" *ngIf="!isPriceLoading(product.id)">
                  {{ formatPrice(getProductPrice(product)) }}
                </span>
                <span class="price-loading" *ngIf="isPriceLoading(product.id)">
                  <nz-spin nzSize="small"></nz-spin>
                </span>
              </div>
              
              <div class="product-actions">
                <div class="quantity-input">
                  <nz-input-number
                    [(ngModel)]="productQuantities[product.id]"
                    [nzMin]="0.1"
                    [nzStep]="0.1"
                    [nzPrecision]="1"
                    nzSize="small"
                    placeholder="Qty"
                    style="width: 80px; margin-right: 8px;"
                  ></nz-input-number>
                </div>
                <button 
                  nz-button 
                  nzType="primary" 
                  nzSize="small"
                  (click)="addToCart(product)"
                  class="add-to-cart-btn"
                  [disabled]="!productQuantities[product.id] || productQuantities[product.id] <= 0 || isPriceLoading(product.id)"
                >
                  <span nz-icon nzType="plus"></span>
                  Add to Cart
                </button>
              </div>
            </div>
          </nz-card>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && products.length === 0" class="empty-state">
        <nz-empty 
          nzNotFoundImage="simple"
          nzNotFoundContent="No products found"
          nzNotFoundFooter="Try adjusting your search or filters"
        ></nz-empty>
      </div>
    </nz-spin>
  </div>

  <!-- Pagination -->
  <div class="pagination-section" *ngIf="total > pageSize">
    <nz-pagination
      [(nzPageIndex)]="page"
      [nzTotal]="total"
      [nzPageSize]="pageSize"
      [nzShowSizeChanger]="false"
      [nzShowQuickJumper]="true"
      (nzPageIndexChange)="onPageChange($event)"
    ></nz-pagination>
  </div>
</div>
