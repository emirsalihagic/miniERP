<div class="shopping-cart">
  <div class="cart-header">
    <h1>Shopping Cart</h1>
    <div class="cart-actions">
      <button 
        type="button"
        class="btn btn-danger"
        (click)="clearCart()"
        [disabled]="!cart || cart.items.length === 0 || updating"
      >
        <span *ngIf="updating" class="spinner"></span>
        <span nz-icon nzType="delete"></span>
        Clear Cart
      </button>
      <button 
        type="button"
        class="btn btn-secondary continue-shopping-btn"
        routerLink="/shop"
      >
        <span nz-icon nzType="shopping"></span>
        Continue Shopping
      </button>
    </div>
  </div>

  <nz-spin [nzSpinning]="loading">
    <div *ngIf="cart && cart.items.length > 0" class="cart-content">
      <!-- Cart Items Table -->
      <nz-card nzTitle="Cart Items" class="cart-items-card">
        <nz-table 
          #cartTable 
          [nzData]="cart.items" 
          [nzShowPagination]="false"
          [nzLoading]="updating"
        >
          <thead>
            <tr>
              <th>
                <span nz-icon nzType="shopping"></span>
                Product
              </th>
              <th>
                <span nz-icon nzType="dollar"></span>
                Unit Price
              </th>
              <th>
                <span nz-icon nzType="number"></span>
                Quantity
              </th>
              <th>
                <span nz-icon nzType="percentage"></span>
                Tax
              </th>
              <th>
                <span nz-icon nzType="calculator"></span>
                Total
              </th>
              <th>
                <span nz-icon nzType="setting"></span>
                Actions
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of cartTable.data">
              <td>
                <div class="product-info">
                  <img 
                    [src]="getProductImage(item)" 
                    [alt]="item.product.name"
                    class="product-image"
                  />
                  <div class="product-details">
                    <div class="product-name">{{ item.product.name }}</div>
                    <div class="product-sku">SKU: {{ item.product.sku }}</div>
      <div class="product-supplier" *ngIf="item.product.supplier">
        <nz-tag nzColor="blue">{{ item.product.supplier.name }}</nz-tag>
      </div>
                    <div class="product-unit" *ngIf="item.product.unit">
                      <span class="unit-label">Unit:</span>
                      <span class="unit-name" *ngIf="isUnitString(item.product.unit)">{{ item.product.unit }}</span>
                      <span class="unit-name" *ngIf="isUnitObject(item.product.unit)">{{ item.product.unit.name }} ({{ item.product.unit.code }})</span>
                    </div>
                  </div>
                </div>
              </td>
              <td>
                <span class="unit-price">{{ formatPrice(Number(item.unitPrice)) }} <span class="vat-label">(excl. VAT)</span></span>
              </td>
              <td>
                <nz-input-number
                  [ngModel]="Number(item.quantity)"
                  (ngModelChange)="updateQuantity(item, $event)"
                  [nzMin]="0.001"
                  [nzStep]="0.001"
                  [nzPrecision]="3"
                  [nzDisabled]="updating"
                  nzSize="small"
                ></nz-input-number>
              </td>
              <td>
                <span class="tax-rate">{{ item.taxRate || 0 }}%</span>
              </td>
              <td>
                <span class="line-total">{{ formatPrice(Number(item.lineTotal)) }}</span>
              </td>
              <td>
                <button 
                  type="button"
                  class="btn btn-sm btn-danger"
                  (click)="removeItem(item)"
                  [disabled]="updating"
                >
                  <span *ngIf="updating" class="spinner"></span>
                  <span nz-icon nzType="delete"></span>
                </button>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </nz-card>

      <!-- Cart Summary -->
      <div class="cart-summary">
        <nz-card nzTitle="Order Summary" class="summary-card">
          <div class="summary-row">
            <span class="label">
              <span nz-icon nzType="shopping"></span>
              Items:
            </span>
            <span class="value">{{ getTotalItemCount() }} items</span>
          </div>
          <div class="summary-row">
            <span class="label">
              <span nz-icon nzType="calculator"></span>
              Subtotal:
            </span>
            <span class="value">{{ formatPrice(Number(cart.subtotal)) }}</span>
          </div>
          <div class="summary-row">
            <span class="label">
              <span nz-icon nzType="percentage"></span>
              Tax:
            </span>
            <span class="value">{{ formatPrice(Number(cart.taxTotal)) }}</span>
          </div>
          <div class="summary-row total-row">
            <span class="label">
              <span nz-icon nzType="dollar"></span>
              Total:
            </span>
            <span class="value">{{ formatPrice(Number(cart.grandTotal)) }}</span>
          </div>
          
          <div class="checkout-actions">
            <button 
              type="button"
              class="btn btn-lg btn-primary checkout-btn"
              routerLink="/shop/checkout"
              [disabled]="!canProceedToCheckout()"
            >
              <span nz-icon nzType="credit-card"></span>
              Proceed to Checkout
            </button>
          </div>
        </nz-card>
      </div>
    </div>

    <!-- Empty Cart State -->
    <div *ngIf="!loading && (!cart || cart.items.length === 0)" class="empty-cart">
      <nz-empty 
        nzNotFoundImage="simple"
        nzNotFoundContent="Your cart is empty"
        nzNotFoundFooter="Start shopping to add items to your cart"
      >
        <ng-container nzExtra>
          <button type="button" class="btn btn-primary" routerLink="/shop">
            <span nz-icon nzType="shopping"></span>
            Browse Products
          </button>
        </ng-container>
      </nz-empty>
    </div>
  </nz-spin>
</div>
