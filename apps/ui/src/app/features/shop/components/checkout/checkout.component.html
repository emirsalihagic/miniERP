<div class="checkout">
  <div class="checkout-header">
    <h1>Checkout</h1>
    <p>Review your order and submit it for processing</p>
  </div>

  <nz-spin [nzSpinning]="loading">
    <div *ngIf="cart && cart.items.length > 0" class="checkout-content">
      <!-- Order Items Review -->
      <nz-card nzTitle="Order Items" class="order-items-card">
        <div class="order-items">
          <div *ngFor="let item of cart.items" class="order-item">
            <div class="item-image">
              <img 
                [src]="getProductImage(item)" 
                [alt]="item.product.name"
                class="product-image"
              />
            </div>
            
            <div class="item-details">
              <div class="item-name">{{ item.product.name }}</div>
              <div class="item-sku">SKU: {{ item.product.sku }}</div>
              <div class="item-supplier" *ngIf="item.product.supplier">
                <nz-tag nzColor="blue">{{ item.product.supplier.name }}</nz-tag>
              </div>
              <div class="item-unit" *ngIf="item.product.unit">
                <span class="unit-label">Unit:</span>
                <span class="unit-name" *ngIf="isUnitString(item.product.unit)">{{ item.product.unit }}</span>
                <span class="unit-name" *ngIf="isUnitObject(item.product.unit)">{{ item.product.unit.name }} ({{ item.product.unit.code }})</span>
              </div>
            </div>

            <div class="item-quantity">
              <span class="quantity-label">Quantity:</span>
              <span class="quantity-value">{{ item.quantity }}</span>
            </div>

            <div class="item-price">
              <span class="price-label">Unit Price:</span>
              <span class="price-value">{{ formatPrice(item.unitPrice) }}</span>
            </div>

            <div class="item-total">
              <span class="total-label">Total:</span>
              <span class="total-value">{{ formatPrice(item.lineTotal) }}</span>
            </div>
          </div>
        </div>
      </nz-card>

      <!-- Order Notes -->
      <nz-card nzTitle="Order Notes" class="order-notes-card">
        <textarea 
          nz-input 
          [(ngModel)]="orderNotes"
          placeholder="Add any special instructions or notes for this order..."
          [nzAutosize]="{ minRows: 3, maxRows: 6 }"
          class="notes-textarea"
        ></textarea>
      </nz-card>

      <!-- Order Summary -->
      <nz-card nzTitle="Order Summary" class="order-summary-card">
        <div class="summary-row">
          <span class="label">Subtotal:</span>
          <span class="value">{{ formatPrice(cart.subtotal) }}</span>
        </div>
        <div class="summary-row">
          <span class="label">Tax:</span>
          <span class="value">{{ formatPrice(cart.taxTotal) }}</span>
        </div>
        <div class="summary-row total-row">
          <span class="label">Total:</span>
          <span class="value">{{ formatPrice(cart.grandTotal) }}</span>
        </div>
        
        <div class="submit-section">
          <div class="order-info">
            <p class="info-text">
              <span nz-icon nzType="info-circle" nzTheme="outline"></span>
              After submitting your order, an invoice will be automatically created and you'll be able to track your order status.
            </p>
          </div>
          
          <div class="submit-actions">
            <button 
              nz-button 
              nzType="default" 
              routerLink="/shop/cart"
              class="back-btn"
            >
              <span nz-icon nzType="arrow-left"></span>
              Back to Cart
            </button>
            
            <button 
              nz-button 
              nzType="primary" 
              nzSize="large"
              (click)="submitOrder()"
              [nzLoading]="submitting"
              [disabled]="!canSubmitOrder()"
              class="submit-btn"
            >
              <span nz-icon nzType="check"></span>
              Submit Order
            </button>
          </div>
        </div>
      </nz-card>
    </div>

    <!-- Empty Cart State -->
    <div *ngIf="!loading && (!cart || cart.items.length === 0)" class="empty-cart">
      <nz-empty 
        nzNotFoundImage="simple"
        nzNotFoundContent="Your cart is empty"
        nzNotFoundFooter="Add items to your cart before checkout"
      >
        <ng-container nzExtra>
          <button nz-button nzType="primary" routerLink="/shop">
            <span nz-icon nzType="shopping"></span>
            Browse Products
          </button>
        </ng-container>
      </nz-empty>
    </div>
  </nz-spin>
</div>
